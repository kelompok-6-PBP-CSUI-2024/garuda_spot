{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>{{ news.title }}</title>
{% endblock meta %}

{% block content %}
<div class="bg-gray-50 w-full min-h-screen">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <div class="mb-6">
      <a href="{% url 'news:show_main' %}" class="text-gray-600 hover:text-gray-900 font-medium">
        ← Back to News
      </a>
    </div>

    <div id="loading-state" class="bg-white rounded-lg border border-gray-200 p-12 text-center">
      <p class="text-gray-600">Loading article…</p>
    </div>

    <div id="error-state" class="bg-white rounded-lg border border-red-200 p-12 text-center hidden">
      <p class="text-red-600">Failed to load article.</p>
    </div>

    <article id="article-content" class="bg-white rounded-lg border border-gray-200 overflow-hidden hidden">
      <div class="p-6 sm:p-8">
        <div id="badges-container" class="flex flex-wrap items-center gap-2 mb-4"></div>

        <h1 id="article-title" class="text-3xl sm:text-4xl font-bold text-gray-900 leading-tight mb-4"></h1>

        <div class="flex flex-wrap items-center text-sm text-gray-500 gap-4">
          <time id="article-date"></time>
        </div>
      </div>

      <div class="p-6 sm:p-8">
        <div id="article-content-text" class="text-gray-700 leading-relaxed whitespace-pre-line text-base sm:text-lg"></div>
      </div>
    </article>
  </div>
</div>

<script>
  const NEWS_ID = "{{ news.id }}";
  const NEWS_DETAIL_ENDPOINT =
    `{% url 'news:show_json_by_id' '00000000-0000-0000-0000-000000000000' %}`
      .replace('00000000-0000-0000-0000-000000000000', NEWS_ID);

  const loadingState = document.getElementById('loading-state');
  const errorState   = document.getElementById('error-state');
  const articleEl    = document.getElementById('article-content');
  const badges       = document.getElementById('badges-container');
  const titleEl      = document.getElementById('article-title');
  const dateEl       = document.getElementById('article-date');
  const contentEl    = document.getElementById('article-content-text');

  function show(state) {
    loadingState.classList.toggle('hidden', state !== 'loading');
    errorState.classList.toggle('hidden',   state !== 'error');
    articleEl.classList.toggle('hidden',    state !== 'ready');
  }

  function renderArticle(n) {
    document.title = `${n.title || '(untitled)'} - Football News`;

    badges.innerHTML = '';
    const cat = document.createElement('span');
    cat.className = 'inline-flex items-center px-3 py-1 rounded-md text-xs font-medium bg-red-600 text-white';
    cat.textContent = n.category || 'General';
    badges.appendChild(cat);

    titleEl.textContent = n.title || '(untitled)';
    dateEl.textContent  = n.publish_date || '';
    contentEl.textContent = n.content || '';
  }

  async function load() {
    try {
      show('loading');
      const res = await fetch(NEWS_DETAIL_ENDPOINT, { headers: { Accept: 'application/json' } });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const n = await res.json();
      renderArticle(n);
      show('ready');
    } catch (e) {
      console.error('detail fetch error:', e);
      show('error');
    }
  }

  document.addEventListener('DOMContentLoaded', load);
</script>
{% endblock content %}
